#!/bin/sh

sxhkd &

~/.config/bspwm/cider_autorule.sh &
# ~/.config/bspwm/dmenu_floating.sh &
# cider &

picom &

killall quickshell || true && sleep 0.5 && quickshell &

bspc config left_padding 0
bspc config right_padding 0
bspc config top_padding 0
bspc config bottom_padding 0

feh --bg-fill ~/Pictures/Wallpaper/wp8.jpg

bspc monitor -d MUSIC 1 2 3 4 5 6 7 8 9 10

bspc rule -a Cider desktop=MUSIC

pgrep -x music-cleaner >/dev/null || (
    music-cleaner() {
        MUSIC_DESK="MUSIC"
        MUSIC_CLASS="Cider"
        while sleep 2; do
            for wid in $(bspc query -N -d "$MUSIC_DESK" -n .window); do
                info=$(bspc query -T -n "$wid")
                # Use xprop for reliable WM_NAME lookup (some apps don't populate bspc .client.title)
                title=$(xprop -id "$wid" WM_NAME 2>/dev/null | sed -n 's/WM_NAME(UTF8_STRING) = "\(.*\)"/\1/p; s/WM_NAME(STRING) = "\(.*\)"/\1/p')
                [ "$title" = "dmenu" ] && continue
                class=$(printf '%s' "$info" | jq -r '.client.className // empty')
                [ "$class" != "$MUSIC_CLASS" ] && bspc node "$wid" -d next.local
            done
        done
    }
    music-cleaner &
)

bspc config split_ratio          0.52
bspc config borderless_monocle   true
bspc config gapless_monocle      true
bspc config focus_follows_pointer true

bspc config border_width               4
bspc config window_gap                 8
bspc config focused_border_color       "#77977e"
bspc config normal_border_color        "#313244"
bspc config active_border_color        "#45475a"
bspc config urgent_border_color        "#ff5e5e"
bspc config presel_feedback_color      "#fab387"

bspc rule -a zen border=off
bspc rule -a i3lock state=floating
bspc rule -a "*:*:dmenu" state=floating border=off center=true
